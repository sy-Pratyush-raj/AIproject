<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Stress Level Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-indigo-800 mb-2">AI Stress Level Tracker</h1>
            <p class="text-lg text-gray-600">Analyzing your voice tone to monitor stress levels in real-time</p>
        </header>

        <!-- Main Chat Container -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <!-- Chat Header -->
            <div class="bg-indigo-600 text-white p-4 flex items-center">
                <div class="w-10 h-10 rounded-full bg-indigo-400 flex items-center justify-center mr-3">
                    <i class="fas fa-robot text-xl"></i>
                </div>
                <div>
                    <h2 class="font-semibold">StressBot</h2>
                    <p class="text-xs opacity-80">Analyzing your stress levels</p>
                </div>
                <div class="ml-auto flex items-center space-x-2">
                    <div class="w-3 h-3 rounded-full bg-green-400"></div>
                    <span class="text-xs">Online</span>
                </div>
            </div>

            <!-- Chat Messages -->
            <div id="chat-container" class="h-96 p-4 overflow-y-auto space-y-4">
                <!-- Welcome message -->
                <div class="flex items-start">
                    <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center mr-2">
                        <i class="fas fa-robot text-indigo-600 text-sm"></i>
                    </div>
                    <div class="bg-indigo-50 rounded-lg p-3 max-w-xs md:max-w-md">
                        <p class="text-gray-800">Hello! I'm your AI Stress Tracker. I can analyze your voice to detect stress levels. Click the microphone button and speak to me for a few seconds.</p>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="border-t border-gray-200 p-4 bg-gray-50">
                <div class="flex items-center">
                    <button id="record-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white rounded-full w-12 h-12 flex items-center justify-center mr-2 transition-colors">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <div class="relative flex-grow">
                        <input type="text" id="user-input" placeholder="Type your message here..." class="w-full border border-gray-300 rounded-full py-2 px-4 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        <button id="send-btn" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-indigo-600 hover:text-indigo-800">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
                <div id="recording-status" class="text-center text-sm text-gray-500 mt-2 hidden">
                    <i class="fas fa-circle text-red-500 animate-pulse mr-1"></i>
                    <span>Recording... Speak now (5 seconds)</span>
                </div>
            </div>
        </div>

        <!-- Stress Level Indicator -->
        <div class="mt-8 bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Your Stress Analysis</h3>
            
            <div class="flex items-center mb-4">
                <div class="w-16 h-16 rounded-full bg-indigo-100 flex items-center justify-center mr-4">
                    <i class="fas fa-heartbeat text-2xl text-indigo-600"></i>
                </div>
                <div class="flex-grow">
                    <div class="flex justify-between mb-1">
                        <span class="text-sm font-medium text-gray-700">Current Stress Level</span>
                        <span id="stress-percent" class="text-sm font-medium text-gray-700">0%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div id="stress-bar" class="bg-indigo-600 h-2.5 rounded-full" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <div id="stress-feedback" class="p-4 rounded-lg bg-indigo-50 border border-indigo-100">
                <p class="text-indigo-800">Speak to me to get your stress level analysis. I'll detect stress indicators like pitch variation, speaking rate, and voice tremors.</p>
            </div>
        </div>

        <!-- Tips Section -->
        <div class="mt-8 bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Stress Management Tips</h3>
            <div id="stress-tips" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                    <h4 class="font-medium text-blue-800 mb-2"><i class="fas fa-spa mr-2"></i>Deep Breathing</h4>
                    <p class="text-sm text-gray-700">Practice 4-7-8 breathing: inhale for 4 seconds, hold for 7, exhale for 8.</p>
                </div>
                <div class="bg-green-50 p-4 rounded-lg border border-green-100">
                    <h4 class="font-medium text-green-800 mb-2"><i class="fas fa-walking mr-2"></i>Physical Activity</h4>
                    <p class="text-sm text-gray-700">A 10-minute walk can significantly reduce stress hormones.</p>
                </div>
                <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-100">
                    <h4 class="font-medium text-yellow-800 mb-2"><i class="fas fa-moon mr-2"></i>Quality Sleep</h4>
                    <p class="text-sm text-gray-700">Maintain a consistent sleep schedule for better stress management.</p>
                </div>
                <div class="bg-purple-50 p-4 rounded-lg border border-purple-100">
                    <h4 class="font-medium text-purple-800 mb-2"><i class="fas fa-medal mr-2"></i>Mindfulness</h4>
                    <p class="text-sm text-gray-700">Try 5 minutes of meditation daily to build resilience to stress.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const recordBtn = document.getElementById('record-btn');
        const recordingStatus = document.getElementById('recording-status');
        const stressBar = document.getElementById('stress-bar');
        const stressPercent = document.getElementById('stress-percent');
        const stressFeedback = document.getElementById('stress-feedback');

        // Audio recording variables
        let mediaRecorder;
        let audioChunks = [];
        let isRecording = false;

        // Add message to chat
        function addMessage(sender, message, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex items-start ${isUser ? 'justify-end' : ''}`;
            
            if (!isUser) {
                messageDiv.innerHTML = `
                    <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center mr-2">
                        <i class="fas fa-robot text-indigo-600 text-sm"></i>
                    </div>
                    <div class="bg-indigo-50 rounded-lg p-3 max-w-xs md:max-w-md">
                        <p class="text-gray-800">${message}</p>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="bg-indigo-100 rounded-lg p-3 max-w-xs md:max-w-md mr-2">
                        <p class="text-gray-800">${message}</p>
                    </div>
                    <div class="w-8 h-8 rounded-full bg-indigo-600 flex items-center justify-center">
                        <i class="fas fa-user text-white text-sm"></i>
                    </div>
                `;
            }
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Update stress level display
        function updateStressLevel(level) {
            const percentage = Math.min(100, Math.max(0, level));
            stressBar.style.width = `${percentage}%`;
            stressPercent.textContent = `${percentage}%`;
            
            // Update color based on stress level
            if (percentage < 30) {
                stressBar.className = 'bg-green-500 h-2.5 rounded-full';
                stressFeedback.innerHTML = '<p class="text-green-800">Your stress level appears low. You seem calm and relaxed.</p>';
            } else if (percentage < 70) {
                stressBar.className = 'bg-yellow-500 h-2.5 rounded-full';
                stressFeedback.innerHTML = '<p class="text-yellow-800">You show moderate stress signs. Try some relaxation techniques.</p>';
            } else {
                stressBar.className = 'bg-red-500 h-2.5 rounded-full';
                stressFeedback.innerHTML = '<p class="text-red-800">Your voice shows high stress indicators. Consider taking a break and practicing deep breathing.</p>';
            }
        }

        // Simulate AI response (in a real app, this would be an API call)
        function getAIResponse(userMessage, isVoice = false) {
            // In a real implementation, this would call your Python backend
            // For now, we'll simulate responses
            
            if (isVoice) {
                // Simulate voice analysis
                const stressLevel = Math.floor(Math.random() * 30) + 50; // Random between 50-80 for demo
                updateStressLevel(stressLevel);
                
                const responses = [
                    "I've analyzed your voice tone. Your speech patterns indicate some stress.",
                    "Based on your voice analysis, you might be experiencing stress.",
                    "Your voice shows signs of tension. Would you like some relaxation tips?"
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            } else {
                // Text responses
                const responses = [
                    "I can better assess your stress by analyzing your voice. Click the microphone to speak.",
                    "For accurate stress measurement, please use the voice recording feature.",
                    "I specialize in voice tone analysis for stress detection. Try speaking to me!"
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }
        }

        // Handle text message sending
        sendBtn.addEventListener('click', () => {
            const message = userInput.value.trim();
            if (message) {
                addMessage('user', message, true);
                userInput.value = '';
                
                // Simulate AI typing
                setTimeout(() => {
                    const response = getAIResponse(message);
                    addMessage('bot', response);
                }, 1000);
            }
        });

        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendBtn.click();
            }
        });

        // Handle voice recording
        recordBtn.addEventListener('click', async () => {
            if (!isRecording) {
                try {
                    // Request microphone access
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    
                    mediaRecorder.ondataavailable = (e) => {
                        audioChunks.push(e.data);
                    };
                    
                    mediaRecorder.onstop = async () => {
                        // In a real app, you would send the audio to your backend
                        // For this demo, we'll simulate processing
                        recordingStatus.classList.add('hidden');
                        recordBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                        recordBtn.classList.remove('bg-red-600');
                        recordBtn.classList.add('bg-indigo-600');
                        
                        addMessage('user', '[Voice Message]', true);
                        
                        // Simulate processing
                        setTimeout(() => {
                            const response = getAIResponse('', true);
                            addMessage('bot', response);
                        }, 2000);
                        
                        audioChunks = [];
                    };
                    
                    // Start recording
                    mediaRecorder.start();
                    audioChunks = [];
                    isRecording = true;
                    recordBtn.innerHTML = '<i class="fas fa-stop"></i>';
                    recordBtn.classList.remove('bg-indigo-600');
                    recordBtn.classList.add('bg-red-600');
                    recordingStatus.classList.remove('hidden');
                    
                    // Stop after 5 seconds for demo
                    setTimeout(() => {
                        if (isRecording) {
                            mediaRecorder.stop();
                            isRecording = false;
                            stream.getTracks().forEach(track => track.stop());
                        }
                    }, 5000);
                    
                } catch (err) {
                    console.error('Error accessing microphone:', err);
                    addMessage('bot', "I couldn't access your microphone. Please check your permissions.");
                    isRecording = false;
                    recordingStatus.classList.add('hidden');
                    recordBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                    recordBtn.classList.remove('bg-red-600');
                    recordBtn.classList.add('bg-indigo-600');
                }
            } else {
                // Stop recording
                mediaRecorder.stop();
                isRecording = false;
                recordingStatus.classList.add('hidden');
                recordBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                recordBtn.classList.remove('bg-red-600');
                recordBtn.classList.add('bg-indigo-600');
            }
        });
    </script>
</body>
</html>